"use strict";var De=Object.defineProperty;var Re=(x,e,r)=>e in x?De(x,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):x[e]=r;var oe=(x,e,r)=>(Re(x,typeof e!="symbol"?e+"":e,r),r);const a=require("vue");let ge=(x=21)=>crypto.getRandomValues(new Uint8Array(x)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");class o{constructor(e,r){oe(this,"x");oe(this,"y");if(typeof e!="number"||typeof r!="number")throw new Error("Must provide numeric parameters");this.x=e,this.y=r}static zero(){return new o(0,0)}add(e){return new o(this.x+e.x,this.y+e.y)}sub(e){return new o(this.x-e.x,this.y-e.y)}neg(){return new o(-this.x,-this.y)}mul(e){if(typeof e=="number")return new o(this.x*e,this.y*e);if(e instanceof o)return this.x*e.x+this.y*e.y;throw new Error("Parameter should be a number or a vector")}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}unit(){let e=this.norm();return new o(this.x/e,this.y/e)}rotate(e){return new o(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))}angle(){return Math.atan2(this.y,this.x)}static _equals(e,r,T=Number.EPSILON){return Math.abs(e-r)<T}equals(e,r=Number.EPSILON){return e instanceof o?o._equals(this.x,e.x,r)&&o._equals(this.y,e.y,r):!1}clone(){return new o(this.x,this.y)}static rad(e){return e*Math.PI/180}static deg(e){return e*180/Math.PI}}const P=8,pe=20,me={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}},qe=["onMousedown"],Ne={key:0,class:"ro-stick-handle"},G=a.defineComponent({__name:"drr",props:{x:{default:0},y:{default:0},width:{default:0},height:{default:0},angle:{default:0},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},hasActiveContent:{type:Boolean,default:!1},aspectRatio:{type:Boolean,default:!1},dragHandle:{default:""},dragCancel:{default:""},outerBound:{default:null},innerBound:{default:null},onDrag:null,onResize:null},emits:["select","deselect","clicked","drag","resize","rotate","rotate-start","rotate-stop","drag-start","drag-stop","resize-start","resize-stop","change","content-active"],setup(x,{emit:e}){const r=x,{x:T,y:ce,width:C,height:k,angle:U,selected:ie,selectable:W,draggable:we,resizable:J,rotatable:ve,hasActiveContent:be,aspectRatio:Q,dragHandle:V,dragCancel:de,outerBound:c,innerBound:i,onDrag:H,onResize:j}=a.toRefs(r),Y=a.ref(ie.value),ee=a.ref(!1),g=a.ref(T.value),p=a.ref(ce.value),L=a.ref((C==null?void 0:C.value)||0),z=a.ref((k==null?void 0:k.value)||0),h=a.ref(U==null?void 0:U.value),D=a.ref(!1),_=a.ref(!1),te=a.ref(!1),ae=a.ref(!1),ue=a.ref(!1),$=a.ref([]),l=a.ref({mouseX:0,mouseY:0,curX:0,curY:0,x:0,y:0,width:0,height:0,rotation:0}),le=a.ref(!1),ne=a.ref(!1),re=a.ref(!1),f=()=>({x:g.value,y:p.value,width:L.value,height:z.value,angle:h.value}),fe=t=>{g.value=t.x,p.value=t.y,L.value=t.width,z.value=t.height,h.value=t.angle},R=a.ref(f()),Ee=a.computed(()=>{const t=[];return J.value&&t.push("tl","tr","br","bl"),ve.value&&t.push("ro"),t}),Ye=a.computed(()=>({active:Y.value,selectable:W.value,dragging:_.value,contentActive:ee.value})),Me=a.computed(()=>({left:`${g.value-L.value/2}px`,top:`${p.value-z.value/2}px`,width:`${L.value}px`,height:`${z.value}px`,transform:`rotate(${h.value}deg)`})),Xe=()=>{W.value&&e("content-active")},Se=a.computed(()=>t=>{const n={width:`${P}px`,height:`${P}px`};return t==="ro"?(n.top=`${-P/2-pe}px`,n.marginLeft=`${-P/2+1}px`):(n[me.y[t[0]]]=`${-P/2}px`,n[me.x[t[1]]]=`${-P/2}px`),n}),Be=t=>{ee.value=t,Y.value=!t},ke=t=>{const n=l.value,s=new o(t.pageX-n.mouseX,t.pageY-n.mouseY);if($.value.includes("ro")){let y=new o(0,-k.value/2-pe);const M=o.rad(n.rotation);y=y.rotate(M);const m=y.add(s);le.value||(e("rotate-start",R.value),le.value=!0),h.value=o.deg(m.angle())+90,ue.value=!0,e("rotate",f())}else{const y=$.value.includes("r")?1:-1,M=$.value.includes("b")?1:-1,m=o.rad(l.value.rotation);let u;if(Q.value){let E=new o(y*l.value.width/2,M*l.value.height/2);E=E.rotate(m).unit(),u=E.mul(E.mul(s))}else u=s;let w=u.rotate(-m);const A=l.value.curX+u.x/2,X=l.value.curY+u.y/2,S=l.value.width+y*w.x,B=l.value.height+M*w.y,b=A-S/2,K=X-B/2,Z=A+S/2,F=X+B/2;if(c.value&&h.value===0){const E=c.value.x-c.value.width/2,q=c.value.y-c.value.height/2,N=c.value.x+c.value.width/2,O=c.value.y+c.value.height/2;let v=0,d=0;b<E&&(v=E-b),Z>N&&(v=N-Z),K<q&&(d=q-K),F>O&&(d=O-F),(v!==0||d!==0)&&(Q.value?v/u.x<d/u.y?(u.y+=v*u.y/u.x,u.x+=v):(u.x+=d*u.x/u.y,u.y+=d):(u.x+=v,u.y+=d))}if(i.value&&h.value===0){const E=i.value.x-i.value.width/2,q=i.value.y-i.value.height/2,N=i.value.x+i.value.width/2,O=i.value.y+i.value.height/2;let v=0,d=0;b>E&&(v=E-b),Z<N&&(v=N-Z),K>q&&(d=q-K),F<O&&(d=O-F),(v!==0||d!==0)&&(Q.value?v/u.x<d/u.y?(u.y+=v*u.y/u.x,u.x+=v):(u.x+=d*u.x/u.y,u.y+=d):(u.x+=v,u.y+=d))}g.value=l.value.curX+u.x/2,p.value=l.value.curY+u.y/2,w=u.rotate(-m),L.value=l.value.width+y*w.x,z.value=l.value.height+M*w.y,j!=null&&j.value&&fe(j.value(f())),ne.value||(e("resize-start",R.value),ne.value=!0),ae.value=!0,e("resize",f())}},Le=t=>{const n={mouseX:t.pageX,mouseY:t.pageY},s={x:n.mouseX-l.value.mouseX,y:n.mouseY-l.value.mouseY},y=l.value.curX+s.x,M=l.value.curY+s.y,m=y-C.value/2,u=M-k.value/2,w=y+C.value/2,A=M+k.value/2;if(c.value&&h.value===0){const X=c.value.x-c.value.width/2,S=c.value.y-c.value.height/2,B=c.value.x+c.value.width/2,b=c.value.y+c.value.height/2;m<X&&(s.x-=m-X),w>B&&(s.x-=w-B),u<S&&(s.y-=u-S),A>b&&(s.y-=A-b)}if(i.value&&h.value===0){const X=i.value.x-i.value.width/2,S=i.value.y-i.value.height/2,B=i.value.x+i.value.width/2,b=i.value.y+i.value.height/2;m>X&&(s.x-=m-X),w<B&&(s.x-=w-B),u>S&&(s.y-=u-S),A<b&&(s.y-=A-b)}g.value=l.value.curX+s.x,p.value=l.value.curY+s.y,H!=null&&H.value&&fe(H.value(f())),re.value||(e("drag-start",R),re.value=!0),te.value=!0,e("drag",f())},ze=()=>{D.value=!1,l.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:g.value,curY:p.value,rotation:h.value},ae.value&&(e("resize-stop",f()),e("change",f())),ue.value&&(e("rotate-stop",f()),e("change",f()))},Ae=(t,n)=>{!J.value||!Y.value||(ne.value=!1,le.value=!1,R.value=f(),D.value=!0,ae.value=!1,ue.value=!1,l.value={mouseX:n.pageX,mouseY:n.pageY,x:t.x,y:t.y,width:L.value,height:z.value,curX:g.value,curY:p.value,rotation:h.value},$.value=t)},Ce=()=>{_.value=!1,l.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:g.value,curY:p.value,rotation:h.value},te.value&&(e("drag-stop",f()),e("change",f()))},I=()=>D.value||_.value,he=t=>{I()&&(t.stopPropagation(),D.value&&ke(t),_.value&&Le(t))},se=()=>{D.value&&ze(),_.value&&Ce()},_e=()=>{e("deselect"),Y.value=!1},ye=()=>{_e()},$e=t=>{if(ee.value||!W.value)return;t.preventDefault(),t.stopPropagation();const n=t.target;Y.value=!0,!(t.button&&t.button!==0)&&(e("clicked",t),!(!we.value||!Y.value)&&(V.value&&(n.getAttribute("data-drag-handle")!=="true"||n.getAttribute("data-drag-cancel")===null)||(_.value=!0,te.value=!1,re.value=!1,R.value=f(),l.value.mouseX=t.pageX,l.value.mouseY=t.pageY,l.value.curX=g.value,l.value.curY=p.value)))},xe=()=>{se()},Ie=()=>{document.addEventListener("mousemove",he),document.addEventListener("mouseup",se),document.addEventListener("mousedown",ye),document.addEventListener("mouseleave",xe)},Pe=()=>{document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",se),document.removeEventListener("mousedown",ye),document.removeEventListener("mouseleave",xe)};return a.onMounted(()=>{if(Ie(),V.value){const t=document.querySelectorAll(V.value);t&&t.forEach(n=>{n.setAttribute("data-drag-handle",ge())})}if(de.value){const t=document.querySelectorAll(de.value);t&&t.forEach(n=>{n.setAttribute("data-drag-cancel",ge())})}}),a.onBeforeUnmount(()=>{Pe()}),a.watch(Y,t=>{e(t?"select":"deselect")}),a.watch(ie,t=>{Y.value=t}),a.watch(be,t=>{Be(t)}),a.watch(T,t=>{I()||(g.value=t)}),a.watch(ce,t=>{I()||(p.value=t)}),a.watch(C,t=>{I()||($.value=["m","r"],L.value=t)}),a.watch(k,t=>{I()||($.value=["b","m"],z.value=t)}),a.watch(U,t=>{I()||(h.value=t)}),(t,n)=>(a.openBlock(),a.createElementBlock("div",{class:a.normalizeClass(["drr",a.unref(Ye)]),style:a.normalizeStyle(a.unref(Me)),onDblclick:Xe,onMousedown:$e},[a.renderSlot(t.$slots,"default"),(a.openBlock(!0),a.createElementBlock(a.Fragment,null,a.renderList(a.unref(Ee),s=>(a.openBlock(),a.createElementBlock("div",{key:s,class:a.normalizeClass(["drr-stick",[`drr-stick-${s}`,a.unref(J)?"":"not-resizable"]]),style:a.normalizeStyle(a.unref(Se)(s)),onMousedown:a.withModifiers(y=>Ae(s,y),["stop","prevent"])},null,46,qe))),128)),a.unref(ve)?(a.openBlock(),a.createElementBlock("div",Ne)):a.createCommentVNode("",!0)],38))}});G.install=x=>{x.component(G.__name,G)};module.exports=G;
