(function(e,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("vue")):typeof define=="function"&&define.amd?define(["vue"],u):(e=typeof globalThis<"u"?globalThis:e||self,e.drr=u(e.Vue))})(this,function(e){"use strict";var Ne=Object.defineProperty;var Oe=(e,u,h)=>u in e?Ne(e,u,{enumerable:!0,configurable:!0,writable:!0,value:h}):e[u]=h;var ie=(e,u,h)=>(Oe(e,typeof u!="symbol"?u+"":u,h),h);class u{constructor(a,s){ie(this,"x");ie(this,"y");if(typeof a!="number"||typeof s!="number")throw new Error("Must provide numeric parameters");this.x=a,this.y=s}static zero(){return new u(0,0)}add(a){return new u(this.x+a.x,this.y+a.y)}sub(a){return new u(this.x-a.x,this.y-a.y)}neg(){return new u(-this.x,-this.y)}mul(a){if(typeof a=="number")return new u(this.x*a,this.y*a);if(a instanceof u)return this.x*a.x+this.y*a.y;throw new Error("Parameter should be a number or a vector")}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}unit(){let a=this.norm();return new u(this.x/a,this.y/a)}rotate(a){return new u(this.x*Math.cos(a)-this.y*Math.sin(a),this.x*Math.sin(a)+this.y*Math.cos(a))}angle(){return Math.atan2(this.y,this.x)}static _equals(a,s,C=Number.EPSILON){return Math.abs(a-s)<C}equals(a,s=Number.EPSILON){return a instanceof u?u._equals(this.x,a.x,s)&&u._equals(this.y,a.y,s):!1}clone(){return new u(this.x,this.y)}static rad(a){return a*Math.PI/180}static deg(a){return a*180/Math.PI}}const h=8,ce=20,de={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}};let ve=(Y=21)=>crypto.getRandomValues(new Uint8Array(Y)).reduce((a,s)=>(s&=63,s<36?a+=s.toString(36):s<62?a+=(s-26).toString(36).toUpperCase():s>62?a+="-":a+="_",a),"");const we=["onMousedown"],be={key:0,class:"ro-stick-handle"},Ee=e.defineComponent({__name:"drr",props:{x:{default:0},y:{default:0},width:{default:0},height:{default:0},angle:{default:0},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},hasActiveContent:{type:Boolean,default:!1},aspectRatio:{type:Boolean,default:!1},dragHandle:{default:""},dragCancel:{default:""},outerBound:{default:null},innerBound:{default:null},onDrag:null,onResize:null},emits:["select","deselect","clicked","drag","resize","rotate","rotate-start","rotate-stop","drag-start","drag-stop","resize-start","resize-stop","change","content-active"],setup(Y,{emit:a}){const s=Y,{x:C,y:j,width:I,height:B,angle:H,selected:fe,selectable:G,draggable:Ye,resizable:W,rotatable:he,hasActiveContent:Me,aspectRatio:J,dragHandle:Q,dragCancel:ye,outerBound:i,innerBound:c,onDrag:V,onResize:ee}=e.toRefs(s),M=e.ref(fe.value),te=e.ref(!1),p=e.ref(C.value),g=e.ref(j.value),z=e.ref((I==null?void 0:I.value)||0),L=e.ref((B==null?void 0:B.value)||0),y=e.ref(H==null?void 0:H.value),q=e.ref(!1),D=e.ref(!1),ae=e.ref(!1),le=e.ref(!1),ue=e.ref(!1),P=e.ref([]),r=e.ref({mouseX:0,mouseY:0,curX:0,curY:0,x:0,y:0,width:0,height:0,rotation:0}),re=e.ref(!1),ne=e.ref(!1),oe=e.ref(!1),f=()=>({x:p.value,y:g.value,width:z.value,height:L.value,angle:y.value}),xe=t=>{p.value=t.x,g.value=t.y,z.value=t.width,L.value=t.height,y.value=t.angle},T=e.ref(f()),Xe=e.computed(()=>{const t=[];return W.value&&t.push("tl","tr","br","bl"),he.value&&t.push("ro"),t}),_e=e.computed(()=>({active:M.value,selectable:G.value,dragging:D.value,contentActive:te.value})),Se=e.computed(()=>({left:p.value-z.value/2+"px",top:g.value-L.value/2+"px",width:z.value+"px",height:L.value+"px",transform:"rotate("+y.value+"deg)"})),ke=()=>{G.value&&a("content-active")},Be=e.computed(()=>t=>{const n={width:`${h}px`,height:`${h}px`};return t=="ro"?(n.top=`${-h/2-ce}px`,n.marginLeft=`${-h/2+1}px`):(n[de.y[t[0]]]=`${-h/2}px`,n[de.x[t[1]]]=`${-h/2}px`),n}),ze=t=>{te.value=t,M.value=!t},Le=t=>{const n=r.value,o=new u(t.pageX-n.mouseX,t.pageY-n.mouseY);if(P.value.includes("ro")){let x=new u(0,-B.value/2-ce);const X=u.rad(n.rotation);x=x.rotate(X);const m=x.add(o);re.value||(a("rotate-start",T.value),re.value=!0),y.value=u.deg(m.angle())+90,ue.value=!0,a("rotate",f())}else{const x=P.value.includes("r")?1:-1,X=P.value.includes("b")?1:-1,m=u.rad(r.value.rotation);let l;if(J.value){let E=new u(x*r.value.width/2,X*r.value.height/2);E=E.rotate(m).unit(),l=E.mul(E.mul(o))}else l=o;let w=l.rotate(-m),A=r.value.curX+l.x/2,_=r.value.curY+l.y/2,S=r.value.width+x*w.x,k=r.value.height+X*w.y,b=A-S/2,K=_-k/2,Z=A+S/2,F=_+k/2;if(i.value&&y.value===0){let E=i.value.x-i.value.width/2,N=i.value.y-i.value.height/2,O=i.value.x+i.value.width/2,$=i.value.y+i.value.height/2,d=0,v=0;b<E&&(d=E-b),Z>O&&(d=O-Z),K<N&&(v=N-K),F>$&&(v=$-F),(d!=0||v!=0)&&(J.value?d/l.x<v/l.y?(l.y+=d*l.y/l.x,l.x+=d):(l.x+=v*l.x/l.y,l.y+=v):(l.x+=d,l.y+=v))}if(c.value&&y.value===0){let E=c.value.x-c.value.width/2,N=c.value.y-c.value.height/2,O=c.value.x+c.value.width/2,$=c.value.y+c.value.height/2,d=0,v=0;b>E&&(d=E-b),Z<O&&(d=O-Z),K>N&&(v=N-K),F<$&&(v=$-F),(d!=0||v!=0)&&(J.value?d/l.x<v/l.y?(l.y+=d*l.y/l.x,l.x+=d):(l.x+=v*l.x/l.y,l.y+=v):(l.x+=d,l.y+=v))}p.value=r.value.curX+l.x/2,g.value=r.value.curY+l.y/2,w=l.rotate(-m),z.value=r.value.width+x*w.x,L.value=r.value.height+X*w.y,ee&&ee.value&&xe(ee.value(f())),ne.value||(a("resize-start",T.value),ne.value=!0),le.value=!0,a("resize",f())}},Ae=t=>{const n={mouseX:t.pageX,mouseY:t.pageY},o={x:n.mouseX-r.value.mouseX,y:n.mouseY-r.value.mouseY};let x=r.value.curX+o.x,X=r.value.curY+o.y,m=x-I.value/2,l=X-B.value/2,w=x+I.value/2,A=X+B.value/2;if(i.value&&y.value===0){let _=i.value.x-i.value.width/2,S=i.value.y-i.value.height/2,k=i.value.x+i.value.width/2,b=i.value.y+i.value.height/2;m<_&&(o.x-=m-_),w>k&&(o.x-=w-k),l<S&&(o.y-=l-S),A>b&&(o.y-=A-b)}if(c.value&&y.value===0){let _=c.value.x-c.value.width/2,S=c.value.y-c.value.height/2,k=c.value.x+c.value.width/2,b=c.value.y+c.value.height/2;m>_&&(o.x-=m-_),w<k&&(o.x-=w-k),l>S&&(o.y-=l-S),A<b&&(o.y-=A-b)}p.value=r.value.curX+o.x,g.value=r.value.curY+o.y,V&&V.value&&xe(V.value(f())),oe.value||(a("drag-start",T),oe.value=!0),ae.value=!0,a("drag",f())},Ce=()=>{q.value=!1,r.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:p.value,curY:g.value,rotation:y.value},le.value&&(a("resize-stop",f()),a("change",f())),ue.value&&(a("rotate-stop",f()),a("change",f()))},Ie=(t,n)=>{!W.value||!M.value||(ne.value=!1,re.value=!1,T.value=f(),q.value=!0,le.value=!1,ue.value=!1,r.value={mouseX:n.pageX,mouseY:n.pageY,x:t.x,y:t.y,width:z.value,height:L.value,curX:p.value,curY:g.value,rotation:y.value},P.value=t)},De=()=>{D.value=!1,r.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:p.value,curY:g.value,rotation:y.value},ae.value&&(a("drag-stop",f()),a("change",f()))},pe=t=>{R()&&(t.stopPropagation(),q.value&&Le(t),D.value&&Ae(t))},se=()=>{q.value&&Ce(),D.value&&De()},Pe=()=>{a("deselect"),M.value=!1},ge=()=>{Pe()},Re=t=>{if(te.value||!G.value)return;t.preventDefault(),t.stopPropagation();const n=t.target;M.value=!0,!(t.button&&t.button!==0)&&(a("clicked",t),!(!Ye.value||!M.value)&&(Q.value&&(n.getAttribute("data-drag-handle")!=="true"||n.getAttribute("data-drag-cancel")===null)||(D.value=!0,ae.value=!1,oe.value=!1,T.value=f(),r.value.mouseX=t.pageX,r.value.mouseY=t.pageY,r.value.curX=p.value,r.value.curY=g.value)))},me=()=>{se()},R=()=>q.value||D.value,qe=()=>{document.addEventListener("mousemove",pe),document.addEventListener("mouseup",se),document.addEventListener("mousedown",ge),document.addEventListener("mouseleave",me)},Te=()=>{document.removeEventListener("mousemove",pe),document.removeEventListener("mouseup",se),document.removeEventListener("mousedown",ge),document.removeEventListener("mouseleave",me)};return e.onMounted(()=>{if(qe(),Q.value){const t=document.querySelectorAll(Q.value);t&&t.forEach(n=>{n.setAttribute("data-drag-handle",ve())})}if(ye.value){const t=document.querySelectorAll(ye.value);t&&t.forEach(n=>{n.setAttribute("data-drag-cancel",ve())})}}),e.onBeforeUnmount(()=>{Te()}),e.watch(M,t=>{a(t?"select":"deselect")}),e.watch(fe,t=>{M.value=t}),e.watch(Me,t=>{ze(t)}),e.watch(C,t=>{R()||(p.value=t)}),e.watch(j,t=>{R()||(g.value=t)}),e.watch(I,t=>{R()||(P.value=["m","r"],z.value=t)}),e.watch(B,t=>{R()||(P.value=["b","m"],L.value=t)}),e.watch(H,t=>{R()||(y.value=t)}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["drr",e.unref(_e)]),style:e.normalizeStyle(e.unref(Se)),onDblclick:ke,onMousedown:Re},[e.renderSlot(t.$slots,"default",{},void 0,!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(Xe),o=>(e.openBlock(),e.createElementBlock("div",{key:o,class:e.normalizeClass(["drr-stick",["drr-stick-"+o,e.unref(W)?"":"not-resizable"]]),style:e.normalizeStyle(e.unref(Be)(o)),onMousedown:e.withModifiers(x=>Ie(o,x),["stop","prevent"])},null,46,we))),128)),e.unref(he)?(e.openBlock(),e.createElementBlock("div",be)):e.createCommentVNode("",!0)],38))}}),$e="",U=((Y,a)=>{const s=Y.__vccOpts||Y;for(const[C,j]of a)s[C]=j;return s})(Ee,[["__scopeId","data-v-dfd06ab1"]]);return U.install=Y=>{Y.component(U.__name,U)},U});
