"use strict";var Re=Object.defineProperty;var qe=(x,e,n)=>e in x?Re(x,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):x[e]=n;var se=(x,e,n)=>(qe(x,typeof e!="symbol"?e+"":e,n),n);const a=require("vue");class s{constructor(e,n){se(this,"x");se(this,"y");if(typeof e!="number"||typeof n!="number")throw new Error("Must provide numeric parameters");this.x=e,this.y=n}static zero(){return new s(0,0)}add(e){return new s(this.x+e.x,this.y+e.y)}sub(e){return new s(this.x-e.x,this.y-e.y)}neg(){return new s(-this.x,-this.y)}mul(e){if(typeof e=="number")return new s(this.x*e,this.y*e);if(e instanceof s)return this.x*e.x+this.y*e.y;throw new Error("Parameter should be a number or a vector")}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}unit(){let e=this.norm();return new s(this.x/e,this.y/e)}rotate(e){return new s(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))}angle(){return Math.atan2(this.y,this.x)}static _equals(e,n,T=Number.EPSILON){return Math.abs(e-n)<T}equals(e,n=Number.EPSILON){return e instanceof s?s._equals(this.x,e.x,n)&&s._equals(this.y,e.y,n):!1}clone(){return new s(this.x,this.y)}static rad(e){return e*Math.PI/180}static deg(e){return e*180/Math.PI}}const P=8,ge=20,pe={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}};let me=(x=21)=>crypto.getRandomValues(new Uint8Array(x)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");const Ne=["onMousedown"],$e={key:0,class:"ro-stick-handle"},Z=a.defineComponent({__name:"drr",props:{x:{default:0},y:{default:0},width:{default:0},height:{default:0},angle:{default:0},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},hasActiveContent:{type:Boolean,default:!1},aspectRatio:{type:Boolean,default:!1},dragHandle:{default:""},dragCancel:{default:""},outerBound:{default:null},innerBound:{default:null},onDrag:null,onResize:null},emits:["select","deselect","clicked","drag","resize","rotate","rotate-start","rotate-stop","drag-start","drag-stop","resize-start","resize-stop","change","content-active"],setup(x,{emit:e}){const n=x,{x:T,y:ie,width:C,height:k,angle:U,selected:ve,selectable:F,draggable:we,resizable:G,rotatable:ce,hasActiveContent:be,aspectRatio:W,dragHandle:J,dragCancel:de,outerBound:i,innerBound:v,onDrag:Q,onResize:V}=a.toRefs(n),Y=a.ref(ve.value),ee=a.ref(!1),g=a.ref(T.value),p=a.ref(ie.value),z=a.ref((C==null?void 0:C.value)||0),L=a.ref((k==null?void 0:k.value)||0),h=a.ref(U==null?void 0:U.value),R=a.ref(!1),_=a.ref(!1),te=a.ref(!1),ae=a.ref(!1),le=a.ref(!1),D=a.ref([]),u=a.ref({mouseX:0,mouseY:0,curX:0,curY:0,x:0,y:0,width:0,height:0,rotation:0}),ue=a.ref(!1),re=a.ref(!1),ne=a.ref(!1),f=()=>({x:g.value,y:p.value,width:z.value,height:L.value,angle:h.value}),fe=t=>{g.value=t.x,p.value=t.y,z.value=t.width,L.value=t.height,h.value=t.angle},q=a.ref(f()),Ee=a.computed(()=>{const t=[];return G.value&&t.push("tl","tr","br","bl"),ce.value&&t.push("ro"),t}),Ye=a.computed(()=>({active:Y.value,selectable:F.value,dragging:_.value,contentActive:ee.value})),Me=a.computed(()=>({left:g.value-z.value/2+"px",top:p.value-L.value/2+"px",width:z.value+"px",height:L.value+"px",transform:"rotate("+h.value+"deg)"})),Xe=()=>{F.value&&e("content-active")},Se=a.computed(()=>t=>{const r={width:`${P}px`,height:`${P}px`};return t=="ro"?(r.top=`${-P/2-ge}px`,r.marginLeft=`${-P/2+1}px`):(r[pe.y[t[0]]]=`${-P/2}px`,r[pe.x[t[1]]]=`${-P/2}px`),r}),Be=t=>{ee.value=t,Y.value=!t},ke=t=>{const r=u.value,o=new s(t.pageX-r.mouseX,t.pageY-r.mouseY);if(D.value.includes("ro")){let y=new s(0,-k.value/2-ge);const M=s.rad(r.rotation);y=y.rotate(M);const m=y.add(o);ue.value||(e("rotate-start",q.value),ue.value=!0),h.value=s.deg(m.angle())+90,le.value=!0,e("rotate",f())}else{const y=D.value.includes("r")?1:-1,M=D.value.includes("b")?1:-1,m=s.rad(u.value.rotation);let l;if(W.value){let E=new s(y*u.value.width/2,M*u.value.height/2);E=E.rotate(m).unit(),l=E.mul(E.mul(o))}else l=o;let w=l.rotate(-m),A=u.value.curX+l.x/2,X=u.value.curY+l.y/2,S=u.value.width+y*w.x,B=u.value.height+M*w.y,b=A-S/2,H=X-B/2,j=A+S/2,K=X+B/2;if(i.value&&h.value===0){let E=i.value.x-i.value.width/2,N=i.value.y-i.value.height/2,$=i.value.x+i.value.width/2,O=i.value.y+i.value.height/2,c=0,d=0;b<E&&(c=E-b),j>$&&(c=$-j),H<N&&(d=N-H),K>O&&(d=O-K),(c!=0||d!=0)&&(W.value?c/l.x<d/l.y?(l.y+=c*l.y/l.x,l.x+=c):(l.x+=d*l.x/l.y,l.y+=d):(l.x+=c,l.y+=d))}if(v.value&&h.value===0){let E=v.value.x-v.value.width/2,N=v.value.y-v.value.height/2,$=v.value.x+v.value.width/2,O=v.value.y+v.value.height/2,c=0,d=0;b>E&&(c=E-b),j<$&&(c=$-j),H>N&&(d=N-H),K<O&&(d=O-K),(c!=0||d!=0)&&(W.value?c/l.x<d/l.y?(l.y+=c*l.y/l.x,l.x+=c):(l.x+=d*l.x/l.y,l.y+=d):(l.x+=c,l.y+=d))}g.value=u.value.curX+l.x/2,p.value=u.value.curY+l.y/2,w=l.rotate(-m),z.value=u.value.width+y*w.x,L.value=u.value.height+M*w.y,V&&V.value&&fe(V.value(f())),re.value||(e("resize-start",q.value),re.value=!0),ae.value=!0,e("resize",f())}},ze=t=>{const r={mouseX:t.pageX,mouseY:t.pageY},o={x:r.mouseX-u.value.mouseX,y:r.mouseY-u.value.mouseY};let y=u.value.curX+o.x,M=u.value.curY+o.y,m=y-C.value/2,l=M-k.value/2,w=y+C.value/2,A=M+k.value/2;if(i.value&&h.value===0){let X=i.value.x-i.value.width/2,S=i.value.y-i.value.height/2,B=i.value.x+i.value.width/2,b=i.value.y+i.value.height/2;m<X&&(o.x-=m-X),w>B&&(o.x-=w-B),l<S&&(o.y-=l-S),A>b&&(o.y-=A-b)}if(v.value&&h.value===0){let X=v.value.x-v.value.width/2,S=v.value.y-v.value.height/2,B=v.value.x+v.value.width/2,b=v.value.y+v.value.height/2;m>X&&(o.x-=m-X),w<B&&(o.x-=w-B),l>S&&(o.y-=l-S),A<b&&(o.y-=A-b)}g.value=u.value.curX+o.x,p.value=u.value.curY+o.y,Q&&Q.value&&fe(Q.value(f())),ne.value||(e("drag-start",q),ne.value=!0),te.value=!0,e("drag",f())},Le=()=>{R.value=!1,u.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:g.value,curY:p.value,rotation:h.value},ae.value&&(e("resize-stop",f()),e("change",f())),le.value&&(e("rotate-stop",f()),e("change",f()))},Ae=(t,r)=>{!G.value||!Y.value||(re.value=!1,ue.value=!1,q.value=f(),R.value=!0,ae.value=!1,le.value=!1,u.value={mouseX:r.pageX,mouseY:r.pageY,x:t.x,y:t.y,width:z.value,height:L.value,curX:g.value,curY:p.value,rotation:h.value},D.value=t)},Ce=()=>{_.value=!1,u.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:g.value,curY:p.value,rotation:h.value},te.value&&(e("drag-stop",f()),e("change",f()))},he=t=>{I()&&(t.stopPropagation(),R.value&&ke(t),_.value&&ze(t))},oe=()=>{R.value&&Le(),_.value&&Ce()},_e=()=>{e("deselect"),Y.value=!1},ye=()=>{_e()},De=t=>{if(ee.value||!F.value)return;t.preventDefault(),t.stopPropagation();const r=t.target;Y.value=!0,!(t.button&&t.button!==0)&&(e("clicked",t),!(!we.value||!Y.value)&&(J.value&&(r.getAttribute("data-drag-handle")!=="true"||r.getAttribute("data-drag-cancel")===null)||(_.value=!0,te.value=!1,ne.value=!1,q.value=f(),u.value.mouseX=t.pageX,u.value.mouseY=t.pageY,u.value.curX=g.value,u.value.curY=p.value)))},xe=()=>{oe()},I=()=>R.value||_.value,Ie=()=>{document.addEventListener("mousemove",he),document.addEventListener("mouseup",oe),document.addEventListener("mousedown",ye),document.addEventListener("mouseleave",xe)},Pe=()=>{document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",oe),document.removeEventListener("mousedown",ye),document.removeEventListener("mouseleave",xe)};return a.onMounted(()=>{if(Ie(),J.value){const t=document.querySelectorAll(J.value);t&&t.forEach(r=>{r.setAttribute("data-drag-handle",me())})}if(de.value){const t=document.querySelectorAll(de.value);t&&t.forEach(r=>{r.setAttribute("data-drag-cancel",me())})}}),a.onBeforeUnmount(()=>{Pe()}),a.watch(Y,t=>{e(t?"select":"deselect")}),a.watch(ve,t=>{Y.value=t}),a.watch(be,t=>{Be(t)}),a.watch(T,t=>{I()||(g.value=t)}),a.watch(ie,t=>{I()||(p.value=t)}),a.watch(C,t=>{I()||(D.value=["m","r"],z.value=t)}),a.watch(k,t=>{I()||(D.value=["b","m"],L.value=t)}),a.watch(U,t=>{I()||(h.value=t)}),(t,r)=>(a.openBlock(),a.createElementBlock("div",{class:a.normalizeClass(["drr",a.unref(Ye)]),style:a.normalizeStyle(a.unref(Me)),onDblclick:Xe,onMousedown:De},[a.renderSlot(t.$slots,"default"),(a.openBlock(!0),a.createElementBlock(a.Fragment,null,a.renderList(a.unref(Ee),o=>(a.openBlock(),a.createElementBlock("div",{key:o,class:a.normalizeClass(["drr-stick",["drr-stick-"+o,a.unref(G)?"":"not-resizable"]]),style:a.normalizeStyle(a.unref(Se)(o)),onMousedown:a.withModifiers(y=>Ae(o,y),["stop","prevent"])},null,46,Ne))),128)),a.unref(ce)?(a.openBlock(),a.createElementBlock("div",$e)):a.createCommentVNode("",!0)],38))}});Z.install=x=>{x.component(Z.__name,Z)};module.exports=Z;
