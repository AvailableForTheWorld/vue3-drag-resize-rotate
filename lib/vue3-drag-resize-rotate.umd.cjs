(function(e,v){typeof exports=="object"&&typeof module<"u"?module.exports=v(require("vue")):typeof define=="function"&&define.amd?define(["vue"],v):(e=typeof globalThis<"u"?globalThis:e||self,e["vue3-drag-resize-rotate"]=v(e.Vue))})(this,function(e){"use strict";var Te=Object.defineProperty;var Ne=(e,v,z)=>v in e?Te(e,v,{enumerable:!0,configurable:!0,writable:!0,value:z}):e[v]=z;var ce=(e,v,z)=>(Ne(e,typeof v!="symbol"?v+"":v,z),z);var v=document.createElement("style");v.textContent=`.drr{position:absolute;box-sizing:border-box;cursor:pointer}.drr img{width:inherit;height:inherit}.drr.active:before{content:"";width:100%;height:100%;position:absolute;top:0;left:0;box-sizing:border-box;outline:2px dashed lightskyblue}.drr.selectable.inactive:hover:before{content:"";width:100%;height:100%;position:absolute;top:0;left:0;box-sizing:border-box;outline:2px dashed #d6d6d6}.drr.non-selectable{pointer-events:none}.drr-stick{box-sizing:border-box;position:absolute;font-size:1px;background:#ffffff;border:1px solid #6c6c6c;box-shadow:0 0 2px #bbb}.drr-stick:hover{border-color:#87cefa}.inactive>.drr-stick{display:none}.drr-stick-tl,.drr-stick-br{cursor:nwse-resize}.drr-stick-tm,.drr-stick-bm{left:50%;cursor:ns-resize}.drr-stick-tr,.drr-stick-bl{cursor:nesw-resize}.drr-stick-ml,.drr-stick-mr{top:50%;cursor:ew-resize}.drr-stick-ro{left:50%;cursor:ew-resize;border-radius:4px}.ro-stick-handle{left:50%;top:-16px;box-sizing:border-box;position:absolute;font-size:1px;background:#ffffff;border:1px solid #6c6c6c;box-shadow:0 0 2px #bbb;width:0px;height:16px}.inactive>.ro-stick-handle{display:none}.drr-stick.not-resizable{display:none}.content-active{border:2px solid lightskyblue}
`,document.head.appendChild(v);let z=(R=21)=>crypto.getRandomValues(new Uint8Array(R)).reduce((a,c)=>(c&=63,c<36?a+=c.toString(36):c<62?a+=(c-26).toString(36).toUpperCase():c>62?a+="-":a+="_",a),"");class s{constructor(a,c){ce(this,"x");ce(this,"y");if(typeof a!="number"||typeof c!="number")throw new Error("Must provide numeric parameters");this.x=a,this.y=c}static zero(){return new s(0,0)}add(a){return new s(this.x+a.x,this.y+a.y)}sub(a){return new s(this.x-a.x,this.y-a.y)}neg(){return new s(-this.x,-this.y)}mul(a){if(typeof a=="number")return new s(this.x*a,this.y*a);if(a instanceof s)return this.x*a.x+this.y*a.y;throw new Error("Parameter should be a number or a vector")}norm(){return Math.sqrt(this.x*this.x+this.y*this.y)}unit(){let a=this.norm();return new s(this.x/a,this.y/a)}rotate(a){return new s(this.x*Math.cos(a)-this.y*Math.sin(a),this.x*Math.sin(a)+this.y*Math.cos(a))}angle(){return Math.atan2(this.y,this.x)}static _equals(a,c,H=Number.EPSILON){return Math.abs(a-c)<H}equals(a,c=Number.EPSILON){return a instanceof s?s._equals(this.x,a.x,c)&&s._equals(this.y,a.y,c):!1}clone(){return new s(this.x,this.y)}static rad(a){return a*Math.PI/180}static deg(a){return a*180/Math.PI}}const A=8,de=20,fe={y:{t:"top",m:"marginTop",b:"bottom"},x:{l:"left",m:"marginLeft",r:"right"}},we=["onMousedown"],ke={key:0,class:"ro-stick-handle"},j=e.defineComponent({__name:"drr",props:{x:{default:0},y:{default:0},width:{default:0},height:{default:0},angle:{default:0},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},hasActiveContent:{type:Boolean,default:!1},aspectRatio:{type:Boolean,default:!1},dragHandle:{default:""},dragCancel:{default:""},outerBound:{default:null},innerBound:{default:null},onDrag:null,onResize:null},emits:["select","deselect","clicked","drag","resize","rotate","rotate-start","rotate-stop","drag-start","drag-stop","resize-start","resize-stop","change","content-active"],setup(R,{emit:a}){const c=R,{x:H,y:ve,width:$,height:B,angle:K,selected:he,selectable:Q,draggable:ze,resizable:V,rotatable:xe,hasActiveContent:Ee,aspectRatio:ee,dragHandle:te,dragCancel:pe,outerBound:u,innerBound:i,onDrag:Z,onResize:F}=e.toRefs(c),E=e.ref(he.value),ae=e.ref(!1),y=e.ref(H.value),g=e.ref(ve.value),_=e.ref(($==null?void 0:$.value)||0),L=e.ref((B==null?void 0:B.value)||0),x=e.ref(K==null?void 0:K.value),q=e.ref(!1),I=e.ref(!1),re=e.ref(!1),le=e.ref(!1),ne=e.ref(!1),P=e.ref([]),l=e.ref({mouseX:0,mouseY:0,curX:0,curY:0,x:0,y:0,width:0,height:0,rotation:0}),oe=e.ref(!1),se=e.ref(!1),ue=e.ref(!1),h=()=>({x:y.value,y:g.value,width:_.value,height:L.value,angle:x.value}),ye=t=>{y.value=t.x,g.value=t.y,_.value=t.width,L.value=t.height,x.value=t.angle},T=e.ref(h()),Ye=e.computed(()=>{const t=[];return V.value&&t.push("tl","tr","br","bl"),xe.value&&t.push("ro"),t}),Me=e.computed(()=>({active:E.value,selectable:Q.value,dragging:I.value,contentActive:ae.value})),Xe=e.computed(()=>({left:`${y.value-_.value/2}px`,top:`${g.value-L.value/2}px`,width:`${_.value}px`,height:`${L.value}px`,transform:`rotate(${x.value}deg)`})),Se=()=>{Q.value&&a("content-active")},Be=e.computed(()=>t=>{const n={width:`${A}px`,height:`${A}px`};return t==="ro"?(n.top=`${-A/2-de}px`,n.marginLeft=`${-A/2+1}px`):(n[fe.y[t[0]]]=`${-A/2}px`,n[fe.x[t[1]]]=`${-A/2}px`),n}),_e=t=>{ae.value=t,E.value=!t},Le=t=>{const n=l.value,o=new s(t.pageX-n.mouseX,t.pageY-n.mouseY);if(P.value.includes("ro")){let p=new s(0,-B.value/2-de);const Y=s.rad(n.rotation);p=p.rotate(Y);const b=p.add(o);oe.value||(a("rotate-start",T.value),oe.value=!0),x.value=s.deg(b.angle())+90,ne.value=!0,a("rotate",h())}else{const p=P.value.includes("r")?1:-1,Y=P.value.includes("b")?1:-1,b=s.rad(l.value.rotation);let r;if(ee.value){let k=new s(p*l.value.width/2,Y*l.value.height/2);k=k.rotate(b).unit(),r=k.mul(k.mul(o))}else r=o;let m=r.rotate(-b);const C=l.value.curX+r.x/2,M=l.value.curY+r.y/2,X=l.value.width+p*m.x,S=l.value.height+Y*m.y,w=C-X/2,G=M-S/2,W=C+X/2,J=M+S/2;if(u.value&&x.value===0){const k=u.value.x-u.value.width/2,N=u.value.y-u.value.height/2,O=u.value.x+u.value.width/2,U=u.value.y+u.value.height/2;let d=0,f=0;w<k&&(d=k-w),W>O&&(d=O-W),G<N&&(f=N-G),J>U&&(f=U-J),(d!==0||f!==0)&&(ee.value?d/r.x<f/r.y?(r.y+=d*r.y/r.x,r.x+=d):(r.x+=f*r.x/r.y,r.y+=f):(r.x+=d,r.y+=f))}if(i.value&&x.value===0){const k=i.value.x-i.value.width/2,N=i.value.y-i.value.height/2,O=i.value.x+i.value.width/2,U=i.value.y+i.value.height/2;let d=0,f=0;w>k&&(d=k-w),W<O&&(d=O-W),G>N&&(f=N-G),J<U&&(f=U-J),(d!==0||f!==0)&&(ee.value?d/r.x<f/r.y?(r.y+=d*r.y/r.x,r.x+=d):(r.x+=f*r.x/r.y,r.y+=f):(r.x+=d,r.y+=f))}y.value=l.value.curX+r.x/2,g.value=l.value.curY+r.y/2,m=r.rotate(-b),_.value=l.value.width+p*m.x,L.value=l.value.height+Y*m.y,F!=null&&F.value&&ye(F.value(h())),se.value||(a("resize-start",T.value),se.value=!0),le.value=!0,a("resize",h())}},Ce=t=>{const n={mouseX:t.pageX,mouseY:t.pageY},o={x:n.mouseX-l.value.mouseX,y:n.mouseY-l.value.mouseY},p=l.value.curX+o.x,Y=l.value.curY+o.y,b=p-$.value/2,r=Y-B.value/2,m=p+$.value/2,C=Y+B.value/2;if(u.value&&x.value===0){const M=u.value.x-u.value.width/2,X=u.value.y-u.value.height/2,S=u.value.x+u.value.width/2,w=u.value.y+u.value.height/2;b<M&&(o.x-=b-M),m>S&&(o.x-=m-S),r<X&&(o.y-=r-X),C>w&&(o.y-=C-w)}if(i.value&&x.value===0){const M=i.value.x-i.value.width/2,X=i.value.y-i.value.height/2,S=i.value.x+i.value.width/2,w=i.value.y+i.value.height/2;b>M&&(o.x-=b-M),m<S&&(o.x-=m-S),r>X&&(o.y-=r-X),C<w&&(o.y-=C-w)}y.value=l.value.curX+o.x,g.value=l.value.curY+o.y,Z!=null&&Z.value&&ye(Z.value(h())),ue.value||(a("drag-start",T),ue.value=!0),re.value=!0,a("drag",h())},Ae=()=>{q.value=!1,l.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:y.value,curY:g.value,rotation:x.value},le.value&&(a("resize-stop",h()),a("change",h())),ne.value&&(a("rotate-stop",h()),a("change",h()))},$e=(t,n)=>{!V.value||!E.value||(se.value=!1,oe.value=!1,T.value=h(),q.value=!0,le.value=!1,ne.value=!1,l.value={mouseX:n.pageX,mouseY:n.pageY,x:t.x,y:t.y,width:_.value,height:L.value,curX:y.value,curY:g.value,rotation:x.value},P.value=t)},Ie=()=>{I.value=!1,l.value={mouseX:0,mouseY:0,x:0,y:0,width:0,height:0,curX:y.value,curY:g.value,rotation:x.value},re.value&&(a("drag-stop",h()),a("change",h()))},D=()=>q.value||I.value,ge=t=>{D()&&(t.stopPropagation(),q.value&&Le(t),I.value&&Ce(t))},ie=()=>{q.value&&Ae(),I.value&&Ie()},Pe=()=>{a("deselect"),E.value=!1},be=()=>{Pe()},De=t=>{if(ae.value||!Q.value)return;t.preventDefault(),t.stopPropagation();const n=t.target;E.value=!0,!(t.button&&t.button!==0)&&(a("clicked",t),!(!ze.value||!E.value)&&(te.value&&(n.getAttribute("data-drag-handle")!=="true"||n.getAttribute("data-drag-cancel")===null)||(I.value=!0,re.value=!1,ue.value=!1,T.value=h(),l.value.mouseX=t.pageX,l.value.mouseY=t.pageY,l.value.curX=y.value,l.value.curY=g.value)))},me=()=>{ie()},Re=()=>{document.addEventListener("mousemove",ge),document.addEventListener("mouseup",ie),document.addEventListener("mousedown",be),document.addEventListener("mouseleave",me)},qe=()=>{document.removeEventListener("mousemove",ge),document.removeEventListener("mouseup",ie),document.removeEventListener("mousedown",be),document.removeEventListener("mouseleave",me)};return e.onMounted(()=>{if(Re(),te.value){const t=document.querySelectorAll(te.value);t&&t.forEach(n=>{n.setAttribute("data-drag-handle",z())})}if(pe.value){const t=document.querySelectorAll(pe.value);t&&t.forEach(n=>{n.setAttribute("data-drag-cancel",z())})}}),e.onBeforeUnmount(()=>{qe()}),e.watch(E,t=>{a(t?"select":"deselect")}),e.watch(he,t=>{E.value=t}),e.watch(Ee,t=>{_e(t)}),e.watch(H,t=>{D()||(y.value=t)}),e.watch(ve,t=>{D()||(g.value=t)}),e.watch($,t=>{D()||(P.value=["m","r"],_.value=t)}),e.watch(B,t=>{D()||(P.value=["b","m"],L.value=t)}),e.watch(K,t=>{D()||(x.value=t)}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["drr",e.unref(Me)]),style:e.normalizeStyle(e.unref(Xe)),onDblclick:Se,onMousedown:De},[e.renderSlot(t.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(Ye),o=>(e.openBlock(),e.createElementBlock("div",{key:o,class:e.normalizeClass(["drr-stick",[`drr-stick-${o}`,e.unref(V)?"":"not-resizable"]]),style:e.normalizeStyle(e.unref(Be)(o)),onMousedown:e.withModifiers(p=>$e(o,p),["stop","prevent"])},null,46,we))),128)),e.unref(xe)?(e.openBlock(),e.createElementBlock("div",ke)):e.createCommentVNode("",!0)],38))}}),Oe="";return j.install=R=>{R.component(j.__name,j)},j});
